<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>stranger for the impatient • stranger</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="stranger for the impatient">
<meta property="og:description" content="stranger">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stranger</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stranger_for_the_impatient.html">stranger for the impatient</a>
    </li>
    <li>
      <a href="../articles/stranger_weirds_methods.html">stranger weirds methods</a>
    </li>
    <li>
      <a href="../articles/working_with_weirds.html">working with weirds</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>stranger for the impatient</h1>
                        <h4 data-toc-skip class="author">WeLoveDataScience</h4>
            
            <h4 data-toc-skip class="date">2022-10-08</h4>
      
      
      <div class="hidden name"><code>stranger_for_the_impatient.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="i-am-so-impatient-i-want-to-get-some-anomalies">I am so impatient: I want to Get some anomalies!<a class="anchor" aria-label="anchor" href="#i-am-so-impatient-i-want-to-get-some-anomalies"></a>
</h2>
<p>Okay… so you checked your favorite method is here. Let’s say
k-nearest neightbors as implemented in <code>FNN</code> package.</p>
<p>Very impatient people may detect some suspicious records using
<code>lucky_odds</code> - though we recommend being a little more
patient: unsupervised anomaly detection requires some patience.</p>
<div class="section level3">
<h3 id="stop-talking-show-now">Stop talking: show now!<a class="anchor" aria-label="anchor" href="#stop-talking-show-now"></a>
</h3>
<p>Loading package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stranger</span><span class="op">)</span></span></code></pre></div>
<p><code>FNN</code> package will be automatically loaded. At this step
ensure it is currently available (installed) in your environment.</p>
<p>On our favorite classical dataset, we perform computations directly
followed by visualisation of top 6 anomalies according to our knn
approach.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anomalies</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/lucky_odds.html">lucky_odds</a></span><span class="op">(</span>n.anom<span class="op">=</span><span class="fl">6</span>, weird<span class="op">=</span><span class="st">"knn"</span>, analysis.drop<span class="op">=</span><span class="st">"Species"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: FNN</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anomalies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Sepal.Length</span>,y<span class="op">=</span><span class="va">Sepal.Width</span>,color<span class="op">=</span><span class="va">Species</span>,size<span class="op">=</span><span class="va">flag_anomaly</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_discrete</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stranger_for_the_impatient_files/figure-html/anom1-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="uh-what-happened">Uh? What happened?<a class="anchor" aria-label="anchor" href="#uh-what-happened"></a>
</h3>
<blockquote>
<p>Yeks! That is very few commands! And I don’t clearly see what
happened. Can you explain?</p>
</blockquote>
<p>Sure. You ask for 6 anomalies using <code>knn</code> weird method, as
computed on all numeric variables of <code>iris</code> dataset. As this
method is you preferred one, you may know it has / should have some
parameters.</p>
<p>We defined some default for you (no certitude they are the best
ones…). Don’t worry, you will be able to modify them according to your
preferences/needs.</p>
<p>There are several things that happened in the background -
corresponding to <code>stranger</code> analysis flow.</p>
<p>There is clearly no assurance that <a href="./../references/lucky_odds.html"><code>lucky_odds</code></a> gives
you relevant anomalies, hence the <em>lucky</em> part of the name. Still
this function has some parameters that can give you some control on the
outputs but knowing the detailed process will allow you better
understand those parameters.</p>
</div>
</div>
<div class="section level2">
<h2 id="anomaly-detection-process-with-stranger">Anomaly detection process with stranger<a class="anchor" aria-label="anchor" href="#anomaly-detection-process-with-stranger"></a>
</h2>
<p>In <code>stanger</code>, we have decomposed the process in some
components having associated verbs.</p>
<ul>
<li><p><strong>Data Preparation</strong>: you can’t just expect right
anomalies if you don’t perform some preliminary steps on data. First,
most of anomalies detection routines just can’t handle missing values.
It is up to the user to handle that aspect before doing analysis (well…
we propose two very simple methods for the very impatient user). Then,
the process will be more relevant if you give as input variable having
comparable ranges. For that, we propose to normalize or rescale within
[0,1] interval. Other treatment we propose is to recode skewed
distribution (taking the logarithm) and the usage of ITDF to recode
categorical variables. Though we recommend to perform data preparation
outside <code>stranger</code> framework, the starting point that may
already to what is recommended is the <code>crazyfy</code> function.
Invoking this verb is mandatory in our process.</p></li>
<li><p><strong>Computational part</strong>: on <em>crazyfied</em> data,
one can apply one or several <em>weirds</em> methods to retrieve
associated anomalies metrics. This could be done with either
<code>strange</code> (one weird method) or <code>stranger</code>
(severall weirds methods at one) functions. Note that at this step we
may end up with various metrics potentially incompatible (distance
versus probability). This leads to the next step:</p></li>
<li><p><strong>Metrics standardisation and stacking</strong> In order to
end up with comparable metrics, we normalize them depending on their
algorithm and nature. In addition, we derive several global anomaly
indicators by stacking the (eventual) multiple metrics you have (for
instance averaging or taking the minimum of ranked metrics). This step
is tackled by the <code>singularize</code> function. This step is
optional and user will also be able to derive anomalies from raw metrics
values (for instance considering abod metric &gt; 2).</p></li>
<li><p><strong>Get anomalies</strong> This tricky part of specifying a
criteria that determined is handled by <code>get_anomalies</code> or
<code>as.anomalies</code> for manual selection on raw metrics. In
addition, one may want to merge anomalies back to initial data (or other
ones), which can be done through Hadley verb
<code>fortify</code>.</p></li>
</ul>
<p>*<strong>Merge back with data</strong> Source data enrichment with
either metrics or anomaly flags is performed thanks to dedicated
<code>fortify</code> methods.</p>
<p>At every of those steps, user can fine-tune the analysis thanks to
some parameters.</p>
<p>Here is an example of explicitely invoke the whole processes step by
step.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>       <span class="co"># remove Species - meaningless to define anomalies</span></span>
<span>  <span class="fu"><a href="../reference/crazyfy.html">crazyfy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                     <span class="co"># data preparation: add id, rescale [0,1], eventualy takes log</span></span>
<span>  <span class="fu"><a href="../reference/strange.html">strange</a></span><span class="op">(</span><span class="st">"knn"</span>,k<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>            <span class="co"># computes knn distances to 5 neighbors, aggregate distances with the mean (default) </span></span>
<span>  <span class="fu"><a href="../reference/singularize.html">singularize</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                 <span class="co"># required step if no manual selection</span></span>
<span>  <span class="fu"><a href="../reference/get_anomalies.html">get_anomalies</a></span><span class="op">(</span>nmin<span class="op">=</span><span class="fl">6</span>,nmax<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># ask for some anomalies</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html" class="external-link">fortify</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">iris</span>,colname<span class="op">=</span><span class="st">"anomaly"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>          <span class="co"># enrich iris dataset with a flag called "anomaly" (0/1)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Sepal.Length</span>,y<span class="op">=</span><span class="va">Sepal.Width</span>,color<span class="op">=</span><span class="va">Species</span>,size<span class="op">=</span><span class="va">anomaly</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># let's view!</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_discrete</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Ordering: -1xN_anom_norm_avg and -1xN_anom_norm_avg</span></span>
<span><span class="co">##  0 outliers found by default with this stacking and this method, which is not enough to satisfy nmin= 6 . Following most probable outliers are added to selection.</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/fullprocess1-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="got-it-i-want-more">Got it! I want more!<a class="anchor" aria-label="anchor" href="#got-it-i-want-more"></a>
</h2>
<div class="section level3">
<h3 id="visualize-anomalies">Visualize anomalies<a class="anchor" aria-label="anchor" href="#visualize-anomalies"></a>
</h3>
<p>Understanding the reasons behind the score of a suspicious record is
quite important to help people to trust the models, even if they don’t
fully understand them. Interpretability is also critical to facilitate
model validation and investiagation of suspicious cases. Unfortunately,
scores made by machine learning models are usually difficult to explain,
especially to non-data scientists. So, we will show in this section how
this problem of interpretability can be partially adressed with few
plots on surrogate models. We know that small regions of the conditional
distribution, such as the k-nearest neighboors of an input record and
their corresponding score, can likely be approximated by linear model.
So by only focusing on that small region, we can use simple models
(i.e. a surrogate model) to explain locally the more complex global
model and visualize these simple models with basic plots. There are
however no guarantees that the surrogate model is highly representative
of the more complex model. So make sure that the results of the
surrogate models are in line with human domain knowledge.</p>
<p>All the provided plots zoom on a specific record and its k-nearest
neighbours, but with a different view each time.</p>
<p>Today, 5 visualizations are implemented;</p>
<ul>
<li>A hierarchical clustering, named “cluster”, showing among the top
n-anomaly which records belongs to the same cluster a specific record.
Finding the commun pattern amoung the cluster may lead to the orign of
of the specifi record score.</li>
<li>A dots plot, named “neighbours”, showing the relationship between
the anomly score and each feature for the k nearest neighbours of a
specific record.</li>
<li>A bar chart, named “feature_importance”, showing how sensitive is
the anomaly score of a specific record to each of feature.</li>
<li>This may help to identify the features behind the score.</li>
<li>A dots plot, names “score_decline”, showing the decrease in anomaly
score among the k nearest neighbours of a specific record.</li>
<li>The shape indicates how extrem and how frequent is the anomaly score
of a speicif record amoung its neighbours.</li>
<li>A Regression tree, named “regression_tree”, showing the roots to
high score around a specific record.</li>
</ul>
<p>Those functions are available though <code>plot</code> methods,
usable on the objects in various steps of the process.</p>
<p>For every graph, a given weird metric must be provided.</p>
<p>Let start for instance to build a <code>stranger</code> object called
<code>is</code> from iris dataset with all default (<code>knn</code>
<em>weird</em> with k=10).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/crazyfy.html">crazyfy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/strange.html">strange</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="similarity-between-top-anomalies">Similarity between top anomalies<a class="anchor" aria-label="anchor" href="#similarity-between-top-anomalies"></a>
</h3>
<p>The option <code>type = "cluser"</code> shows a hierarchical cluster
among the top highest score around a specif record. The plot on the top,
called “Full Tree”, helps you to select the number of cluster according
to the zoom level of your interest. The plot on the bottom, called ”
Zooming-in”, zooms in the cluster in which the selected records belongs
to. Finding the commun pattern within a cluster (or sub-cluster) should
provide you insights on what has driven the score.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>   <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"cluster"</span>,score <span class="op">=</span> <span class="st">"knn_k_10_mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<pre><code><span><span class="co">## Your data has been converted to a dataframe to be compatible with ggplot function.</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
<div class="section level4">
<h4 id="note-on-unshown-default-parameters">Note on unshown default parameters<a class="anchor" aria-label="anchor" href="#note-on-unshown-default-parameters"></a>
</h4>
<p>Call with all parameters (except the ones specific to the type of
plot) could be - with default values used:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span>type<span class="op">=</span><span class="st">"cluster"</span>,</span>
<span>id <span class="op">=</span> <span class="st">".id"</span>,</span>
<span>score <span class="op">=</span> <span class="st">"knn_k_10_mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<pre><code><span><span class="co">## Your data has been converted to a dataframe to be compatible with ggplot function.</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<p>In <code>stranger</code> default process, required <code>id</code> is
named <strong>.id</strong>, thus default value is suitable.</p>
<p>The parameter <code>anomaly_id</code> is used to pick one specific
anomaly as identified by its id. Using the default value
<code>NULL</code> the record having highest anomaly score (here based on
<strong>knn_k_10_mean</strong>) is used.</p>
</div>
</div>
<div class="section level3">
<h3 id="univariate-relationship">Univariate relationship<a class="anchor" aria-label="anchor" href="#univariate-relationship"></a>
</h3>
<p>The option <code>type = "neighbours"</code> shows a dots plot with a
loess regression that emphasis the relationship between the anomly score
and each numerical feature for a specific record and its k-nearest
neighbours.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span>type<span class="op">=</span><span class="st">"neighbours"</span>,score <span class="op">=</span> <span class="st">"knn_k_10_mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<pre><code><span><span class="co">## Your data has been converted to a dataframe to be compatible with ggplot function.</span></span></code></pre>
<pre><code><span><span class="co">## `geom_smooth()` using formula 'y ~ x'</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="decision-tree">Decision tree<a class="anchor" aria-label="anchor" href="#decision-tree"></a>
</h3>
<p>The option <code>type = "regression_tree"</code> shows roots to lead
to high score locally around a specific record. The function use a
pruned <code>rpart</code> regression tree where score is used as the
dependent feature and all others feature as covariates. This approaches
has been inspired by the model [LIME] (<a href="https://arxiv.org/pdf/1602.04938.pdf" class="external-link uri">https://arxiv.org/pdf/1602.04938.pdf</a>).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"regression_tree"</span>,score <span class="op">=</span> <span class="st">"knn_k_10_mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<pre><code><span><span class="co">## Your data has been converted to a dataframe to be compatible with ggplot function.</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: rpart</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="variables-importance">Variables importance<a class="anchor" aria-label="anchor" href="#variables-importance"></a>
</h3>
<p>The option <code>type = "feature_importance"</code> shows a dotplot
sorted by decreasing variable importance. Such variable importance is
derived from fitting a random forest using anomaly id as a target.</p>
<p>Due to the approach, this graphic is not suited for small data (both
in terms of records and columns).</p>
<p>Fitting random forest is performed with <code>ranger</code> package
for efficiency purpose.</p>
<p>Note that: - A list of id may be provided. - For that plot method,
score should be specified and is only used when <code>anomaly_id</code>
is <code>NULL</code> (to determine top anomaly).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span>type<span class="op">=</span><span class="st">"feature_importance"</span>,score <span class="op">=</span> <span class="st">"knn_k_10_mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<pre><code><span><span class="co">## Your data has been converted to a dataframe to be compatible with ggplot function.</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: ranger</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="score-decline">Score decline<a class="anchor" aria-label="anchor" href="#score-decline"></a>
</h3>
<p>The option <code>type = "score_decline"</code> shows a dots plot that
highlight the decline in anomaly score among the k nearest neighbours of
a specific record. The shape is an indicator of how extrem and how
frequent is the score of a specific record amoung its neighbours.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"scores_decline"</span>,score <span class="op">=</span> <span class="st">"knn_k_10_mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<pre><code><span><span class="co">## Your data has been converted to a dataframe to be compatible with ggplot function.</span></span></code></pre>
<p><img src="stranger_for_the_impatient_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="to-go-further">To go further…<a class="anchor" aria-label="anchor" href="#to-go-further"></a>
</h2>
<p>Explore additional vignettes. Next recommended vignette deals about
working with several methods at once: * <strong>Working with several
methods</strong> (<a href="./articles/tbd.html"><tbd></tbd></a>) introduce the
usage of <code>stranger</code> function, the possibility to <a href="./reference/merge.html"><code>merge</code></a> and stack
(aggregate) methods with <a href="./references/singularize.html"><code>singularize</code></a>.</p>
<p>Then you will be interested in knowing the list of available methods,
which you can find there: * <strong>Stranger weirds methods</strong> (<a href="./articles/stranger_weirds_methods.html">vignette</a>) list all
available <em>weirds</em> with some information on them.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Eric Lecoutre, Sven Wauters.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
