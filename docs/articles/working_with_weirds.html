<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>working with weirds • stranger</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">stranger</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stranger_for_the_impatient.html">stranger for the impatient</a>
    </li>
    <li>
      <a href="../articles/stranger_weirds_methods.html">stranger weirds methods</a>
    </li>
    <li>
      <a href="../articles/working_with_weirds.html">working with weirds</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/welovedatascience/stranger">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>working with weirds</h1>
                        <h4 class="author">WeLoveDataScience</h4>
            
            <h4 class="date">2018-01-23</h4>
          </div>

    
    
<div class="contents">
<div id="anomalies-manual-selection" class="section level1">
<h1 class="hasAnchor">
<a href="#anomalies-manual-selection" class="anchor"></a>Anomalies manual selection</h1>
<p>For some metrics, litterature recommends some cutpoints (2 for <code>lof</code> for instance).</p>
<p>There is a way to derive anomalies from this given cutpoint by filtering a stranger or a singularize object and convert to anomalies the set of retained records.</p>
<p>Filtering can be done either with usual <code>[</code> or <code>dplyr</code> <code>select</code>.</p>
<p>Assumed <code>dbscan</code> package is installed, one can for instance use <code>lof</code> weird, use 2 as cutpoint and derive an anomaly object with <a href="./../references/as.anomalies.html"><code>as.anomalies</code></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/crazyfy.html">crazyfy</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/stranger.html">strange</a></span>(<span class="dt">weird=</span><span class="st">"lof"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/singularize.html">singularize</a></span>() -&gt;<span class="st"> </span>s</code></pre></div>
<pre><code>## Loading required package: dbscan</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anom &lt;-<span class="st"> </span><span class="kw">filter</span>(s,lof_k_<span class="dv">10</span><span class="op">&gt;</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/as.anomalies.html">as.anomalies</a></span>()</code></pre></div>
<p><strong>NOTE</strong> our current implementation of <code>select</code> is not pipeable; we are still trying to ingest Hadley Wickham litterature on programming with <code>dyplyr</code>…</p>
<p>Anomaly objects are simple vectors with attributes; once can then access the first anomaly and display it with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(s,<span class="dt">type=</span><span class="st">"neighbours"</span>, <span class="dt">score=</span><span class="st">"lof_k_10"</span>,<span class="dt">anomaly_id=</span>anom[<span class="dv">1</span>])</code></pre></div>
<pre><code>## Your data has been converted to a dataframe to be compatible with ggplot function.</code></pre>
<pre><code>## Loading required package: FNN</code></pre>
<p><img src="working_with_weirds_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
</div>
<div id="using-a-tunegrid" class="section level1">
<h1 class="hasAnchor">
<a href="#using-a-tunegrid" class="anchor"></a>Using a tuneGrid</h1>
<p><code>stranger</code> package is a wrapper around several methods. Problem thus arrives on the <em>choice</em> of the method… We will see later in this vignette how to work with several metrics and in particular the stacking.</p>
<p>But world is really complex and even for one chosen method, leyt say <code>knn</code> <em>weird</em>, user has to pick some parameters…</p>
<p>Here comes the parameter <code>tuneGrid</code> (name borrowed from <code>caret</code>) that allow to use one <em>weird</em> with different sets of parameters in the same call.</p>
<p>Let’s prepare a matrix of parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">k=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>),<span class="dt">simplify=</span><span class="kw">c</span>(<span class="st">"mean"</span>,<span class="st">"median"</span>),<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
tg</code></pre></div>
<pre><code>##    k simplify
## 1  5     mean
## 2 10     mean
## 3 20     mean
## 4  5   median
## 5 10   median
## 6 20   median</code></pre>
<p>We thus have 6 possible combinations</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(anoms.all &lt;-<span class="st">  </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/crazyfy.html">crazyfy</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/stranger.html">strange</a></span>(<span class="dt">weird=</span><span class="st">"knn"</span>,<span class="dt">tuneGrid=</span>tg))</code></pre></div>
<pre><code>##      .id knn_k_5_mean knn_k_10_mean knn_k_20_mean knn_k_5_median
##   1:   1   0.02560115    0.03647553    0.05368046     0.02601460
##   2:   2   0.03628835    0.04448610    0.06322990     0.03894765
##   3:   3   0.03605785    0.04354593    0.05611057     0.03894765
##   4:   4   0.03256554    0.04072704    0.05649871     0.02977918
##   5:   5   0.03984542    0.04519420    0.05902922     0.04195510
##  ---                                                            
## 146: 146   0.07056222    0.08621572    0.11121305     0.07400789
## 147: 147   0.07533194    0.10077827    0.12428750     0.07925859
## 148: 148   0.07167463    0.08622770    0.10228438     0.07429926
## 149: 149   0.08643839    0.10152256    0.12754738     0.10533133
## 150: 150   0.06003996    0.07692173    0.10060785     0.06290052
##      knn_k_10_median knn_k_20_median
##   1:      0.03488959      0.05278479
##   2:      0.04426191      0.05939418
##   3:      0.04408645      0.05960504
##   4:      0.04182115      0.05447469
##   5:      0.04771224      0.05636842
##  ---                                
## 146:      0.09178279      0.11484551
## 147:      0.10273185      0.13174353
## 148:      0.08791375      0.10983492
## 149:      0.11319301      0.12104827
## 150:      0.08442104      0.10450279</code></pre>
<p><strong>NOTES</strong></p>
<ul>
<li>
<code>stranger</code> naming conventions do not necessary involve all parameters, we though ensure unique names and store parameters values as attributes (metadata) for every metric.</li>
<li>Currently, only parameters exposed in <em>weird</em> method are allowed in tuning grid. User can still invoke methods several times with different values for other parameters and merge results as seen in next section or use <code>stranger</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">k=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>))
(anoms &lt;-<span class="st">  </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/crazyfy.html">crazyfy</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/stranger.html">strange</a></span>(<span class="dt">weird=</span><span class="st">"knn"</span>,<span class="dt">tuneGrid=</span>tg,<span class="dt">algorithm=</span><span class="kw">c</span>(<span class="st">"cover_tree"</span>)))</code></pre></div>
<pre><code>##      .id knn_k_5_mean knn_k_5_mean.1 knn_k_6_mean knn_k_7_mean
##   1:   1   0.02560115     0.02560115   0.02800096   0.03034193
##   2:   2   0.03628835     0.03628835   0.03800174   0.03946357
##   3:   3   0.03605785     0.03605785   0.03749732   0.03879323
##   4:   4   0.03256555     0.03256555   0.03458706   0.03603100
##   5:   5   0.03984543     0.03984543   0.04115709   0.04216815
##  ---                                                          
## 146: 146   0.07056224     0.07056224   0.07412305   0.07668065
## 147: 147   0.07533194     0.07533194   0.08271409   0.08860528
## 148: 148   0.07167465     0.07167465   0.07490411   0.07773136
## 149: 149   0.08643838     0.08643838   0.09089748   0.09425377
## 150: 150   0.06003996     0.06003996   0.06483095   0.06838887
##      knn_k_8_mean
##   1:   0.03244721
##   2:   0.04128187
##   3:   0.04027742
##   4:   0.03734822
##   5:   0.04306710
##  ---             
## 146:   0.07947144
## 147:   0.09333819
## 148:   0.08103779
## 149:   0.09678463
## 150:   0.07124970</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(meta  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_info.html">get_info</a></span>(anoms))</code></pre></div>
<pre><code>##                weird_method          name  package package.source
## knn_k_5_mean   "k-Nearest Neighbour" "knn" "FNN"   "CRAN"        
## knn_k_5_mean.1 "k-Nearest Neighbour" "knn" "FNN"   "CRAN"        
## knn_k_6_mean   "k-Nearest Neighbour" "knn" "FNN"   "CRAN"        
## knn_k_7_mean   "k-Nearest Neighbour" "knn" "FNN"   "CRAN"        
## knn_k_8_mean   "k-Nearest Neighbour" "knn" "FNN"   "CRAN"        
##                foo        type       sort
## knn_k_5_mean   "knn.dist" "distance" -1  
## knn_k_5_mean.1 "knn.dist" "distance" -1  
## knn_k_6_mean   "knn.dist" "distance" -1  
## knn_k_7_mean   "knn.dist" "distance" -1  
## knn_k_8_mean   "knn.dist" "distance" -1  
##                detail                              parameters
## knn_k_5_mean   "Positive numeric value (distance)" List,3    
## knn_k_5_mean.1 "Positive numeric value (distance)" List,3    
## knn_k_6_mean   "Positive numeric value (distance)" List,3    
## knn_k_7_mean   "Positive numeric value (distance)" List,3    
## knn_k_8_mean   "Positive numeric value (distance)" List,3    
##                normalizationFunction colname       
## knn_k_5_mean   ?                     "knn_k_5_mean"
## knn_k_5_mean.1 ?                     "knn_k_5_mean"
## knn_k_6_mean   ?                     "knn_k_6_mean"
## knn_k_7_mean   ?                     "knn_k_7_mean"
## knn_k_8_mean   ?                     "knn_k_8_mean"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">meta[,<span class="st">"parameters"</span>]</code></pre></div>
<pre><code>## $knn_k_5_mean
## $knn_k_5_mean$k
## [1] 5
## 
## $knn_k_5_mean$algorithm
## [1] "cover_tree"
## 
## $knn_k_5_mean$simplify
## [1] "mean"
## 
## 
## $knn_k_5_mean.1
## $knn_k_5_mean.1$k
## [1] 5
## 
## $knn_k_5_mean.1$algorithm
## [1] "cover_tree"
## 
## $knn_k_5_mean.1$simplify
## [1] "mean"
## 
## 
## $knn_k_6_mean
## $knn_k_6_mean$k
## [1] 6
## 
## $knn_k_6_mean$algorithm
## [1] "cover_tree"
## 
## $knn_k_6_mean$simplify
## [1] "mean"
## 
## 
## $knn_k_7_mean
## $knn_k_7_mean$k
## [1] 7
## 
## $knn_k_7_mean$algorithm
## [1] "cover_tree"
## 
## $knn_k_7_mean$simplify
## [1] "mean"
## 
## 
## $knn_k_8_mean
## $knn_k_8_mean$k
## [1] 8
## 
## $knn_k_8_mean$algorithm
## [1] "cover_tree"
## 
## $knn_k_8_mean$simplify
## [1] "mean"</code></pre>
</div>
<div id="merging-stranger-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#merging-stranger-objects" class="anchor"></a>Merging stranger objects</h1>
<p>So you have decided to go for and try two different methods. Let say <em>knn</em> and <em>autoencode</em>.</p>
<p>First, we can create two object containg assciatdd metrics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/crazyfy.html">crazyfy</a></span>()
m1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stranger.html">strange</a></span>(data, <span class="dt">weird=</span><span class="st">"knn"</span>)
m2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stranger.html">strange</a></span>(data, <span class="dt">weird=</span><span class="st">"autoencode"</span>)</code></pre></div>
<pre><code>## Loading required package: autoencoder</code></pre>
<pre><code>## autoencoding...
## Optimizer counts:
## function gradient 
##      191       53 
## Optimizer: successful convergence.
## Optimizer: convergence = 0, message = 
## J.init = 41.81893, J.final = 0.3689983, mean(rho.hat.final) = 0.001385937</code></pre>
<p>For convenience and further exploitation, a <code>merge</code> method is at your disposal to gather the two corresponding metrics in a single object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(metrics &lt;-<span class="st"> </span><span class="kw">merge</span>(m1,m2))</code></pre></div>
<pre><code>##      .id knn_k_10_mean autoencode_nl_3_Nhidden_10
##   1:   1    0.03647553                 0.06989930
##   2:   2    0.04448610                 0.06869046
##   3:   3    0.04354593                 0.07304249
##   4:   4    0.04072704                 0.06892880
##   5:   5    0.04519420                 0.07180840
##  ---                                             
## 146: 146    0.08621572                 0.05846855
## 147: 147    0.10077827                 0.03393882
## 148: 148    0.08622770                 0.03886931
## 149: 149    0.10152256                 0.05923877
## 150: 150    0.07692173                 0.02544889</code></pre>
</div>
<div id="invoke-several-weirds-at-once-stranger" class="section level1">
<h1 class="hasAnchor">
<a href="#invoke-several-weirds-at-once-stranger" class="anchor"></a>Invoke several weirds at once (stranger)</h1>
<p>You are not sure yet about the metric you want to use. Or you would like to test many, with plenty of different values for the parameters? <code>stranger</code> is for you. This function is similar to <code>caretList</code> in <code>caretEnsemble</code> package.</p>
<p>With its first parameter <em>methodList</em> you can supply many methods that will be invoked with their default parameter.</p>
<p>If you want to use your own values or use a tuneGrid for a given method, you will have to create <em>weird</em> objects using <code>weird</code> function and pass a list of such <em>weirds</em> object to the parameter <em>tuneList</em>.</p>
<p>Following call will for instance: * fit a knn <em>weird</em> with default values (taken from <em>methodList</em>) * fit a autoencode <em>weird</em> with default values * also fit a knn but with <em>k</em> set to 20 (not recommended for iris data having 50 observations)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s3=<span class="kw"><a href="../reference/stranger.html">stranger</a></span>(data,
    <span class="dt">methodList=</span><span class="kw">c</span>(<span class="st">"knn"</span>,<span class="st">"autoencode"</span>),
    <span class="dt">tuneList=</span><span class="kw">list</span>(<span class="kw"><a href="../reference/weird.html">weird</a></span>(<span class="dt">method=</span><span class="st">"knn"</span>,<span class="dt">k=</span><span class="dv">20</span>)))</code></pre></div>
<pre><code>## autoencoding...
## Optimizer counts:
## function gradient 
##       94       42 
## Optimizer: successful convergence.
## Optimizer: convergence = 0, message = 
## J.init = 41.81809, J.final = 0.36859, mean(rho.hat.final) = 0.001219024</code></pre>
</div>
<div id="does-not-work-autoencode-tunegrid" class="section level1">
<h1 class="hasAnchor">
<a href="#does-not-work-autoencode-tunegrid" class="anchor"></a>does not work (autoencode tuneGrid)</h1>
<p>ss=stranger(data, methodList=c(“lof”), tuneList=list( weird(method=“knn”, tuneGrid=data.frame(k=c(3,5,10,15))) , weird(method=“autoencode”,colname=“auto_2hidden”,nl=4,N.hidden=c(6,15)) , weird(method=“autoencode”, colname=“auto”, tuneGrid=data.frame(nl=3,N.hidden=c(6,15,30)))))</p>
<p>anom &lt;- ss %&gt;% singularize() %&gt;% get_anomalies(nmin=6,nmax=6)</p>
<p>anom %&gt;% fortify(data=iris,colname=“anomaly”) %&gt;% ggplot(aes(x=Sepal.Length,y=Sepal.Width,color=Species,size=anomaly))+geom_point()+scale_size_discrete(range=c(1,3))</p>
</div>
<div id="normalize-stack-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#normalize-stack-metrics" class="anchor"></a>Normalize &amp; stack metrics</h1>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#anomalies-manual-selection">Anomalies manual selection</a></li>
      <li><a href="#using-a-tunegrid">Using a tuneGrid</a></li>
      <li><a href="#merging-stranger-objects">Merging stranger objects</a></li>
      <li><a href="#invoke-several-weirds-at-once-stranger">Invoke several weirds at once (stranger)</a></li>
      <li><a href="#does-not-work-autoencode-tunegrid">does not work (autoencode tuneGrid)</a></li>
      <li><a href="#normalize-stack-metrics">Normalize &amp; stack metrics</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Eric Lecoutre, Sven Wauters.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
